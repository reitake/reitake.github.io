$(window).load(function(){$("#faq").dialog({title:"Mission Set Generator - FAQ",closeText:"X",dialogClass:"faq",draggable:!1,autoOpen:!1,modal:!0,resizable:!1,width:700,show:{effect:"explode",duration:400},hide:{effect:"explode",duration:400},open:function(e,t){$(".ui-widget-overlay.ui-front").click(function(){$("#faq").dialog("close")})}}),$("#help").click(function(){$("#faq").dialog("open")}),window.boxElement=$(".img-container > img"),window.loader=$(".loading"),window.rowMAX=25,window.hMAX=148*rowMAX,window.cOptions={aspectRatio:888/hMAX,autoCropArea:1,strict:!1,guides:!1,highlight:!1,center:!1,background:!1,minCropBoxWidth:888,minContainerWidth:888,minCropBoxHeight:hMAX,minContainerHeight:hMAX,dragCrop:!1,cropBoxMovable:!1,cropBoxResizable:!1,doubleClickToggle:!1,crop:function(e){},build:function(e){loader.show()},built:function(e){boxElement.cropper("setAspectRatio",2),boxElement.cropper("setCropBoxData",{top:0,height:444}),boxElement.cropper("setCanvasData",{top:0,left:0}),$(".img-container").height(444),$(".cropper-crop-box, .cropper-container").height(444),loader.hide()}},boxElement.cropper(cOptions);var e,t=$("#file"),o=window.URL||window.webkitURL;o?t.change(function(){var i,n=this.files;boxElement.data("cropper")&&n&&n.length&&(i=n[0],/^image\/\w+$/.test(i.type)?(ruota_reset(),$("#slider-stretchX").slider("option","value",a),$("#slider-stretchY").slider("option","value",a),$("#slider-transp").slider("option","value",100),$("#btnLessRow").siblings("span").text("Rows (3/25)"),$("#btnLessRow, #btnMoreRow").removeClass("disabled"),window.cColor="rgba(0,0,0,0)",$(".cropper-view-box").css("background-color",window.cColor),$("#cColor").spectrum("set",window.cColor),e=o.createObjectURL(i),boxElement.one("built.cropper",function(){o.revokeObjectURL(e)}).cropper("reset").cropper("replace",e),t.val("")):showMessage("Please choose an image file."))}):t.parent().remove(),clearFilename=function(e){var t=["\\","/",":","*","?",'"',"<",">","|"];for(i in t){var o=t[i],a=e.indexOf(o);if(a>-1)return!1}return e=e.replace(/\s/g,"-")},readbleDate=function(e){var t=e.getFullYear(),o=zeroPad(e.getMonth()+1,2),a=zeroPad(e.getDate(),2),i=zeroPad(e.getHours(),2),n=zeroPad(e.getMinutes(),2),r=zeroPad(e.getSeconds(),2),l=t+o+a+"-"+i+n+r;return l},zeroPad=function(e,t){e=e.toString();var o=t-e.length;return Array(o>0?o+1:0).join("0")+e},getMockup=function(){var e=1.5,t=1/e,o=20*e,a=128*e,i=a+o,n=$(".img-container").height()/148,r=6,l=i*r,s=i*n,c=boxElement.cropper("getCroppedCanvas",{width:l,height:s}),p=document.createElement("canvas");p.width=l,p.height=s;var d=p.getContext("2d"),g=new Image;g.src="img/mask.png";var u=document.createElement("canvas"),h=u.getContext("2d");u.width=i,u.height=i,h.drawImage(g,0,0,i*t,i*t,0,0,i,i),d.fillStyle="#000",d.fillRect(0,0,l,s),d.fillStyle=window.cColor,d.fillRect(0,0,l,s);var b=document.createElement("canvas"),w=b.getContext("2d");b.width=l,b.height=s,w.globalAlpha=window.cTransp,w.drawImage(c,0,0),d.drawImage(b,0,0);var m=d.createPattern(u,"repeat");d.rect(0,0,l,s),d.fillStyle=m,d.fill();var v=p.toDataURL("image/png");return v},getBadges=function(){for(var e=window.outputRis/128,t=20*e,o=128*e,a=o+t,i=$(".img-container").height()/148,n=6,r=a*n,l=a*i,s=boxElement.cropper("getCroppedCanvas",{width:r,height:l}),c=o/2,p=t/2,d=[],g=0;i>g;g++)for(var u=0;n>u;u++){var h=document.createElement("canvas");h.width=o,h.height=o;var b=h.getContext("2d");window.cMask&&(b.arc(c,c,c,0,2*Math.PI),b.clip()),b.fillStyle=window.cColor,b.fillRect(0,0,o,o);var w=document.createElement("canvas"),m=w.getContext("2d");if(w.width=r,w.height=l,m.globalAlpha=window.cTransp,m.drawImage(s,0,0),b.drawImage(w,0,0,r,l,-(o*u+t*u+p),-(o*g+t*g+p),r,l),window.cRing){var v=window.outputRis/64;b.beginPath(),b.arc(c,c,c-v/2,0,2*Math.PI),b.lineWidth=v,b.strokeStyle="#ff9a0a",b.stroke()}var x=n*i-(6*g+u),f=h.toDataURL("image/png"),E=zeroPad(x,2)+".png";d.push([E,f])}return d},downloadBadges=function(){var e=new Date,t=readbleDate(e),o=$("input#bannerTitle").val(),a=""!=o?clearFilename(o):"mission-set";if(a===!1)return alert('You cannot use /:*?"<>| in the title'),!1;var i=getMockup(),n=getBadges(),r=new JSZip,l=["CREDITS","Generated with www.tiny.cc/missionset"];r.file(a+"-"+t+"/"+l[0]+".txt",l[1]),r.file(a+"-"+t+"/"+a+".png",i.replace("data:image/png;base64,",""),{base64:!0});for(b in n){var s=n[b][0],c=n[b][1],p=a+"-"+s;r.file(a+"-"+t+"/badges/"+p,c.replace("data:image/png;base64,",""),{base64:!0})}var d=r.generate({type:"blob"});saveAs(d,a+"-"+t+".zip")};var a=50,n=0;$("#slider-stretchX").slider({min:-a-n,max:a+n,step:1,value:a,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("100%, 100%")},change:function(e,t){var o=(t.value/a,boxElement.cropper("getData"));$(this).siblings(".value").text(parseInt(100*o.scaleX)+"% , "+parseInt(100*o.scaleY)+"%")},slide:function(e,t){var o=t.value/a,i=boxElement.cropper("getData");boxElement.cropper("scale",o,i.scaleY),$(this).siblings(".value").text(parseInt(100*o)+"% , "+parseInt(100*i.scaleY)+"%")}}),$("#slider-stretchY").slider({min:-a-n,max:a+n,step:1,value:a,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("100%, 100%")},change:function(e,t){var o=(t.value/a,boxElement.cropper("getData"));$(this).siblings(".value").text(parseInt(100*o.scaleX)+"% , "+parseInt(100*o.scaleY)+"%")},slide:function(e,t){var o=t.value/a,i=boxElement.cropper("getData");boxElement.cropper("scale",i.scaleX,o),$(this).siblings(".value").text(parseInt(100*i.scaleX)+"% , "+parseInt(100*o)+"%")}}),scaleX=function(){var e=boxElement.cropper("getData");boxElement.cropper("scale",-e.scaleX,+e.scaleY),$("#slider-stretchX").slider("option","value",-e.scaleX*a)},scaleY=function(){var e=boxElement.cropper("getData");boxElement.cropper("scale",+e.scaleX,-e.scaleY),$("#slider-stretchY").slider("option","value",-e.scaleY*a)},resetScaleX=function(){var e=boxElement.cropper("getData");boxElement.cropper("scale",1,+e.scaleY),$("#slider-stretchX").slider("option","value",a)},resetScaleY=function(){var e=boxElement.cropper("getData");boxElement.cropper("scale",e.scaleX,1),$("#slider-stretchY").slider("option","value",a)},reset_img=function(){ruota_reset(),boxElement.cropper("reset")},$("#slider-mask").slider({min:0,max:100,step:5,value:90,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("90%")},slide:function(e,t){var o=t.value/100;$(".mask").css("opacity",o),$(this).siblings(".value").text(t.value+"%")}}),$("#slider-size").slider({min:20,max:180,step:10,value:100,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("100%")},slide:function(e,t){var o=t.value/100;$("#main .container").css("transform","scale("+o+")"),$(this).siblings(".value").text(t.value+"%")}}),$("#slider-zoom").slider({min:.01,max:.15,step:.01,value:window.boxElement.cropper("getZoomRatio"),orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("x10")},slide:function(e,t){window.boxElement.cropper("setZoomRatio",t.value),$(this).siblings(".value").text("x"+parseInt(100*t.value))}}),$("#btnZoomSuperOut").click(function(){boxElement.cropper("zoom",-window.boxElement.cropper("getZoomRatio"))}),$("#btnZoomSuperIn").click(function(){boxElement.cropper("zoom",+window.boxElement.cropper("getZoomRatio"))}),$("#slider-rotate").slider({min:-180,max:180,step:1,value:0,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("0°")},slide:function(e,t){var o=t.value,a=boxElement.cropper("getData").rotate;boxElement.cropper("rotate",o-a),$(this).siblings(".value").text(t.value+"°")},change:function(e,t){$(this).siblings(".value").text(t.value+"°")}}),ruota_45=function(){var e=boxElement.cropper("getData").rotate,t=45;boxElement.cropper("rotate",t),e+=t,e>180&&(e-=360),$("#slider-rotate").slider("option","value",e)},ruota_reset=function(){var e=boxElement.cropper("getData").rotate;boxElement.cropper("rotate",-e),$("#slider-rotate").slider("option","value",0)},window.cTransp=1,$("#slider-transp").slider({min:0,max:100,step:5,value:100,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("100%")},slide:function(e,t){var o=t.value/100;window.cTransp=o,$(".cropper-view-box img").css("opacity",o),$(this).siblings(".value").text(t.value+"%")},change:function(e,t){$(this).siblings(".value").text(t.value+"%")}}),$("#btnLessRow").on("click",function(){var e=$(".img-container").height(),t=e-148;t>=148&&($("#btnLessRow, #btnMoreRow").removeClass("disabled"),$(".img-container").height(t),$(".cropper-crop-box, .cropper-container").height(t),boxElement.cropper("setAspectRatio",888/t),boxElement.cropper("setCropBoxData",{top:0,height:t}),148==t&&$(this).addClass("disabled"),$(this).parent().siblings("span").text("Rows ("+t/148+"/"+hMAX/148+")"))}),$("#btnMoreRow").on("click",function(){var e=$(".img-container").height(),t=e+148;t<=hMAX&&($("#btnLessRow, #btnMoreRow").removeClass("disabled"),$(".img-container").height(t),$(".cropper-crop-box, .cropper-container").height(t),boxElement.cropper("setAspectRatio",888/t),boxElement.cropper("setCropBoxData",{top:0,height:t}),t==hMAX&&$(this).addClass("disabled"),$(this).parent().siblings("span").text("Rows ("+t/148+"/"+hMAX/148+")"))}),window.outputRis=512,$("#slider-output").slider({min:128,max:512,step:64,value:window.outputRis,orientation:"horizontal",create:function(e,t){$(this).siblings(".value").text("512x512")},slide:function(e,t){var o=t.value;window.outputRis=o,$(this).siblings(".value").text(o+"x"+o)}}),window.cMask=!1,circleMask=function(){window.cMask?window.cMask=!1:window.cMask=!0},window.cRing=!1,goldRing=function(){window.cRing?window.cRing=!1:window.cRing=!0},window.cColor="rgba(0,0,0,0)",$("#cColor").spectrum({containerClassName:"niaPalette",replacerClassName:"col12 first niaBtn",color:"rgba(0,0,0,0)",preferredFormat:"rgba",flat:!1,allowEmpty:!0,showInitial:!0,showAlpha:!0,showButtons:!0,move:function(e){var t=e.toRgbString();$(".cropper-view-box").css("background-color",t)},change:function(e){window.cColor=e.toRgbString(),console.log("cambiato")},hide:function(e){console.log("chiusoooo"),$(".cropper-view-box").css("background-color",window.cColor),$("#cColor").spectrum("set",window.cColor)}}),$(".action-bar").prepend('<span class="toggle-btn cyan" title="Tools Bar"><span>&#9666;</span></span>'),$(".action-bar").toggleClass("open"),$(".toggle-btn").click(function(){$(this).parent(".action-bar").hasClass("open")?$(this).children("span").html("&#9656;"):$(this).children("span").html("&#9666;"),$(this).parent(".action-bar").toggleClass("open")})});